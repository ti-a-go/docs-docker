# Docker e Docker Compose

[Documentação Docker](https://docs.docker.com/reference/dockerfile/)

Essa é uma aplicação de teste utilizando Docker e Docker Compose.

Ela apenas exibe uma página web (desenvolvida em Node) com uma frase.


# Como executar o projeto

## Usando Docker Compose

```bash
docker compose up
```

Após isso podemos acessar a página web a partir de um navegador com esse link:

[http://localhost:8080/](http://localhost:8080/)

## Usando Docker

Criar uma imagem a partir do [Dockerfile](./Dockerfile):

```bash
docker build -t test/app-node:1.0 .
```

Criar o container a partir da imagem criada acima:

```bash
docker run -p 8080:3000 -d test/app-node:1.0 .
```

Após isso podemos acessar a página web a partir de um navegador com esse link:

[http://localhost:8080/](http://localhost:8080/)



## Comandos úteis

Lista os conteiners em execução:

```bash
docker container ls
```

Lista apenas os IDs conteiners em execução:

```bash
docker container ls -q
```

Remove um conteiner em execução a partir do seu ID:

```bash
docker stop <id>
```

Remove todos os containers em execução:

```bash
docker stop $(docker container ls -q)
```

Criando um container com um volume:

```bash
docker run -it -v meu-volume:/app ubuntu bash
```


# Volumes

[Documentação](https://docs.docker.com/engine/storage/volumes/)

> [!IMPORTANT]
> Volumes are the preferred mechanism for persisting **data generated by and used by Docker containers**.

While bind mounts are dependent on the directory structure and OS of the host machine, **volumes are completely managed by Docker**. 


<img src="https://docs.docker.com/engine/storage/images/types-of-mounts-volume.webp" width="400">

Volumes have several **advantages** over bind mounts:

- Volumes are **easier to back up or migrate** than bind mounts.
- You can manage volumes using **Docker CLI** commands or the **Docker API**.
- Volumes **work on both Linux and Windows** containers.
- Volumes can be more **safely shared among multiple containers**.
- Volume drivers let you *store volumes on remote hosts* or *cloud providers*, *encrypt the contents* of volumes, or add other functionality.
- New volumes can have their *content pre-populated* by a container.
Volumes on Docker Desktop have much **higher performance** than bind mounts *from Mac and Windows* hosts.

In addition, **volumes are often a better choice than persisting data in a container's writable layer**, because a volume **doesn't increase the size of the containers using it**, and the volume's **contents exist outside the lifecycle of a given container**.

When to use `tmpfs` instead of `volumes`:

If your container generates **non-persistent state data**, consider using a **tmpfs** mount to avoid storing the data anywhere permanently, and to increase the container's performance by avoiding writing into the container's writable layer.


## Comandos

```bash
docker volume ls
```

Criando um container com um volume:

```bash
docker run -it -v meu-volume:/app ubuntu bash
```

Ou:

```bash
docker run -it --mount source=meu-volume,target=/app ubuntu bash
```


# Bind Mounts

[Documentação](https://docs.docker.com/engine/storage/bind-mounts/)

Bind mounts **have limited functionality compared to volumes**. 

When you use a bind mount, a file or directory on the host machine is mounted into a container. 

The file or directory is referenced by its absolute path on the host machine. 

By contrast, when you use a volume, a new directory is created within Docker's storage directory on the host machine, and Docker manages that directory's contents.

The file or directory does not need to exist on the Docker host already. It is created on demand if it does not yet exist. Bind mounts are very performant, but they rely on the host machine's filesystem having a specific directory structure available. If you are developing new Docker applications, consider using named volumes instead. You can't use Docker CLI commands to directly manage bind mounts.

# TMPFS

[Documentação](https://docs.docker.com/engine/storage/tmpfs/)

Volumes and bind mounts let you share files between the host machine and container so that you can persist data even after the container is stopped.

If you're running Docker on Linux, you have a third option: tmpfs mounts. When you create a container with a tmpfs mount, the container can create files outside the container's writable layer.

As opposed to volumes and bind mounts, a tmpfs mount is temporary, and only persisted in the host memory. When the container stops, the tmpfs mount is removed, and files written there won't be persisted.

This is useful to temporarily store sensitive files that you don't want to persist in either the host or the container writable layer.

Limitations of tmpfs mounts:

- Unlike volumes and bind mounts, you can't share tmpfs mounts between containers.
- This functionality is only available if you're running Docker on Linux.
- Setting permissions on tmpfs may cause them to reset after container restart. In some cases setting the uid/gid can serve as a workaround.